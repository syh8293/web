<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì±… ë§Œìª½ ì½ê¸° ê¸°ë¡</title>
  <style>
    :root { --primary: #2f6fed; --edit: #f39c12; --delete: #e74c3c; --bg: #f7f7f5; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg); color: #222; max-width: 480px; margin: 0 auto;
      height: 100vh; display: flex; flex-direction: column; overflow: hidden;
    }
    header { padding: 15px 20px 5px; background: var(--bg); }
    h1 { font-size: 1.2rem; margin: 0; }
    
    /* ì…ë ¥ ì˜ì—­ ê³ ì • */
    #input-container { padding: 0 20px 10px; background: var(--bg); border-bottom: 1px solid #ddd; }
    .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 12px; }
    
    label { display: block; font-size: 0.75rem; margin-bottom: 3px; font-weight: bold; color: #444; }
    input {
      width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 6px;
      border: 1px solid #ccc; font-size: 0.9rem; box-sizing: border-box;
    }
    
    .btn-group { display: flex; gap: 8px; }
    button {
      flex: 1; padding: 10px; border: none; border-radius: 8px;
      background: var(--primary); color: white; font-size: 0.9rem; cursor: pointer; font-weight: bold;
    }
    
    /* ìŠ¤í¬ë¡¤ ì˜ì—­ */
    #scroll-area { flex: 1; overflow-y: auto; padding: 10px 20px; }

    /* ë‹¬ì„±ë¥  ê·¸ë˜í”„ */
    .percent-text { font-size: 1.8rem; font-weight: 800; color: var(--primary); text-align: center; margin-bottom: 5px; }
    .progress-wrapper { height: 12px; background: #e0e0e0; border-radius: 6px; overflow: hidden; }
    #progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.5s; }

    /* ë¦¬ìŠ¤íŠ¸ ê³µí†µ */
    .section-title { font-size: 0.9rem; margin: 5px 0 8px 5px; font-weight: bold; }
    .history-item { 
      background: white; border-radius: 10px; padding: 10px; margin-bottom: 8px;
      border-left: 4px solid var(--primary); cursor: pointer;
    }
    .history-date { font-weight: bold; font-size: 0.8rem; display: flex; justify-content: space-between; }
    .history-title { font-size: 0.85rem; margin: 3px 0; color: #333; }

    /* ì™„ë… ë¦¬ìŠ¤íŠ¸ */
    .completed-item { font-size: 0.85rem; padding: 5px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between; }
    .completed-item:last-child { border-bottom: none; }

    .edit-mode-active { border: 2px solid var(--edit) !important; background: #fffdf9 !important; }
    .btn-edit { background: var(--edit); }
    .btn-delete { background: var(--delete); flex: 0.4; }
    .btn-cancel { background: #888; flex: 0.4; }
  </style>
</head>
<body>

  <header><h1>ì±… ë§Œìª½ ì½ê¸°</h1></header>

  <div id="input-container">
    <div class="card" id="inputCard">
      <div style="display: grid; grid-template-columns: 1fr 1.2fr; gap: 8px;">
        <div><label>ë‚ ì§œ</label><input type="date" id="date" /></div>
        <div><label>ì±… ì œëª©</label><input type="text" id="title" placeholder="ì±… ì œëª©" /></div>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
        <div><label>ì‹œì‘ í˜ì´ì§€</label><input type="number" id="startPage" /></div>
        <div><label>ì¢…ë£Œ í˜ì´ì§€</label><input type="number" id="endPage" /></div>
      </div>
      <div id="normal-btns"><button onclick="saveEntry()">ê¸°ë¡í•˜ê¸°</button></div>
      <div id="edit-btns" style="display: none;" class="btn-group">
        <button class="btn-edit" onclick="saveEntry()">ìˆ˜ì •ì™„ë£Œ</button>
        <button class="btn-delete" onclick="deleteEntry()">ì‚­ì œ</button>
        <button class="btn-cancel" onclick="cancelEdit()">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <div id="scroll-area">
    <div class="card">
      <div id="percent-val" class="percent-text">0%</div>
      <div class="progress-wrapper"><div id="progress-bar"></div></div>
      <div id="total-text" style="text-align:center; font-size:0.8rem; margin-top:8px; color:#666;">ëˆ„ì  0p / 10,000p</div>
    </div>

    <div class="section-title">ğŸ† ì™„ë…í•œ ì±… ëª©ë¡</div>
    <div class="card" id="completed-box" style="min-height: 40px;">
      <div id="completed-list"></div>
    </div>

    <div class="section-title">ğŸ“… ìµœê·¼ ë…ì„œ ê¸°ë¡</div>
    <div id="history-list"></div>
  </div>

  <script>
    const TARGET = 10000;
    let entries = JSON.parse(localStorage.getItem('readingEntries') || '[]');
    let editIndex = -1;

    document.getElementById('date').value = new Date().toISOString().substring(0, 10);

    function saveEntry() {
      const date = document.getElementById('date').value;
      const title = document.getElementById('title').value || "ì œëª© ì—†ìŒ";
      const start = Number(document.getElementById('startPage').value);
      const end = Number(document.getElementById('endPage').value);

      if (!date || isNaN(start) || isNaN(end)) { alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }

      const newEntry = { date, title, startPage: start, endPage: end, pages: (end - start + 1) };

      if (editIndex === -1) { entries.push(newEntry); } 
      else { entries[editIndex] = newEntry; }

      localStorage.setItem('readingEntries', JSON.stringify(entries));
      
      // ì œëª©/ì¢…ë£Œí˜ì´ì§€ ìœ ì§€, ì‹œì‘í˜ì´ì§€ëŠ” ì¢…ë£Œ+1
      document.getElementById('startPage').value = end + 1;
      
      cancelEdit(); 
      render();
    }

    function deleteEntry() {
      if (confirm("ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        entries.splice(editIndex, 1);
        localStorage.setItem('readingEntries', JSON.stringify(entries));
        cancelEdit();
        render();
      }
    }

    function startEdit(index) {
      editIndex = index;
      const t = entries[index];
      document.getElementById('date').value = t.date;
      document.getElementById('title').value = t.title;
      document.getElementById('startPage').value = t.startPage;
      document.getElementById('endPage').value = t.endPage;

      document.getElementById('inputCard').classList.add('edit-mode-active');
      document.getElementById('normal-btns').style.display = 'none';
      document.getElementById('edit-btns').style.display = 'flex';
      document.getElementById('scroll-area').scrollTo({top: 0, behavior: 'smooth'});
    }

    function cancelEdit() {
      editIndex = -1;
      document.getElementById('inputCard').classList.remove('edit-mode-active');
      document.getElementById('normal-btns').style.display = 'block';
      document.getElementById('edit-btns').style.display = 'none';
    }

    function render() {
      // 1. ë‹¬ì„±ë¥  ë° ê¸°ë¡ ë¦¬ìŠ¤íŠ¸
      const historyDiv = document.getElementById('history-list');
      historyDiv.innerHTML = '';
      let totalSum = 0;
      let bookStats = {}; // ì™„ë… ê³„ì‚°ìš©

      [...entries].reverse().forEach((item, revIdx) => {
        totalSum += item.pages;
        const actualIdx = entries.length - 1 - revIdx;

        // ìµœê·¼ ê¸°ë¡ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        const div = document.createElement('div');
        div.className = 'history-item';
        div.onclick = () => startEdit(actualIdx);
        div.innerHTML = `
          <div class="history-date"><span>${item.date}</span><span style="color:var(--primary)">+${item.pages}p</span></div>
          <div class="history-title">${item.title}</div>
        `;
        historyDiv.appendChild(div);

        // ì±…ë³„ ëˆ„ì  í˜ì´ì§€ í•©ì‚°
        if (!bookStats[item.title]) bookStats[item.title] = 0;
        bookStats[item.title] += item.pages;
      });

      // 2. ì™„ë…í•œ ì±… ëª©ë¡ ì—…ë°ì´íŠ¸
      const completedDiv = document.getElementById('completed-list');
      completedDiv.innerHTML = '';
      const bookTitles = Object.keys(bookStats);
      if (bookTitles.length === 0) {
        completedDiv.innerHTML = '<div style="color:#aaa; font-size:0.8rem; text-align:center;">ì•„ì§ ì™„ë…í•œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
      } else {
        bookTitles.forEach(title => {
          const item = document.createElement('div');
          item.className = 'completed-item';
          item.innerHTML = `<span>ğŸ“– ${title}</span> <b>${bookStats[title].toLocaleString()}p</b>`;
          completedDiv.appendChild(item);
        });
      }

      // 3. ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
      const percent = Math.min((totalSum / TARGET) * 100, 100).toFixed(1);
      document.getElementById('percent-val').innerText = percent + '%';
      document.getElementById('progress-bar').style.width = percent + '%';
      document.getElementById('total-text').innerText = `ëˆ„ì  ${totalSum.toLocaleString()}p / ${TARGET.toLocaleString()}p`;
    }

    render();
  </script>
</body>
</html>